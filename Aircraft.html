<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviation Lesson: The Propeller</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 300px;
        }
        h1 { margin: 0 0 10px 0; font-size: 1.2em; color: #333; }
        p { font-size: 0.9em; color: #555; }
        .control-group { margin-top: 10px; }
        label { font-size: 0.9em; font-weight: bold; }
        
        /* 3D Label Styles */
        .label {
            color: #FFF;
            font-family: sans-serif;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none; /* Let mouse clicks pass through */
            white-space: nowrap;
        }
        .arrow-label {
            color: yellow;
            font-weight: bold;
        }
    </style>
    <!-- Import Map for Three.js (No build tools needed) -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <!-- User Interface -->
    <div id="info">
        <h1>Propeller Anatomy</h1>
        <p>Rotate camera with mouse. Scroll to zoom.</p>
        
        <div class="control-group">
            <label for="rpmSlider">RPM (Speed):</label><br>
            <input type="range" id="rpmSlider" min="0" max="0.5" step="0.01" value="0.02">
        </div>
        <p style="font-size: 0.8em; color: red;">*Slow down to read labels!</p>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        // --- 1. SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); // Sky Blue background

        // Camera
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(5, 3, 5);

        // Renderer (WebGL)
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Label Renderer (CSS2D - for HTML labels on top of 3D)
        const labelRenderer = new CSS2DRenderer();
        labelRenderer.setSize(window.innerWidth, window.innerHeight);
        labelRenderer.domElement.style.position = 'absolute';
        labelRenderer.domElement.style.top = '0px';
        document.body.appendChild(labelRenderer.domElement);

        // Controls
        const controls = new OrbitControls(camera, labelRenderer.domElement);
        controls.enableDamping = true;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const sunLight = new THREE.DirectionalLight(0xffffff, 1);
        sunLight.position.set(10, 20, 10);
        sunLight.castShadow = true;
        scene.add(sunLight);

        // --- 2. PROPELLER CREATION ---

        // Group to hold the whole propeller assembly
        const propellerGroup = new THREE.Group();
        scene.add(propellerGroup);

        // A. The Spinner/Hub (Central Cylinder)
        const hubGeometry = new THREE.CylinderGeometry(0.5, 0.5, 1, 32);
        const hubMaterial = new THREE.MeshStandardMaterial({ color: 0x888888, metalness: 0.8, roughness: 0.3 });
        const hub = new THREE.Mesh(hubGeometry, hubMaterial);
        hub.rotation.x = Math.PI / 2; // Lay it flat facing forward
        hub.castShadow = true;
        propellerGroup.add(hub);

        // B. The Blades
        const bladeMaterial = new THREE.MeshStandardMaterial({ color: 0x222222 }); // Black blades
        const tipMaterial = new THREE.MeshStandardMaterial({ color: 0xffcc00 }); // Yellow tips

        function createBlade(angle) {
            const bladeGroup = new THREE.Group();

            // Main blade part
            const bladeGeo = new THREE.BoxGeometry(3.5, 0.4, 0.05);
            // Shift geometry so rotation happens at the hub, not the center of the blade
            bladeGeo.translate(2, 0, 0); 
            
            const bladeMesh = new THREE.Mesh(bladeGeo, bladeMaterial);
            
            // BLADE TWIST (PITCH): Rotate the blade slightly along its long axis
            bladeMesh.rotation.x = Math.PI / 6; // 30 degrees pitch
            
            bladeGroup.add(bladeMesh);

            // Blade Tip (Yellow)
            const tipGeo = new THREE.BoxGeometry(0.5, 0.4, 0.05);
            tipGeo.translate(4, 0, 0); // Position at end
            const tipMesh = new THREE.Mesh(tipGeo, tipMaterial);
            tipMesh.rotation.x = Math.PI / 6; // Same pitch
            bladeGroup.add(tipMesh);

            // Rotate the whole blade group around the hub
            bladeGroup.rotation.z = angle;
            
            return bladeGroup;
        }

        // Add 2 Blades
        const blade1 = createBlade(0);
        const blade2 = createBlade(Math.PI); // 180 degrees opposite
        propellerGroup.add(blade1);
        propellerGroup.add(blade2);

        // --- 3. LABELS (Educational Overlays) ---
        
        function addLabel(text, parentObject, x, y, z, customClass = 'label') {
            const div = document.createElement('div');
            div.className = customClass;
            div.textContent = text;
            const label = new CSS2DObject(div);
            label.position.set(x, y, z);
            parentObject.add(label);
            return label;
        }

        // Add static labels (attached to the group, they will spin with it)
        addLabel("Hub", hub, 0, 0.5, 0);
        
        // Add detailed labels to Blade 1
        // Note: Coordinates are relative to the blade group
        addLabel("Leading Edge", blade1, 2.5, 0.5, 0.5);
        addLabel("Trailing Edge", blade1, 2.5, -0.5, -0.5);
        addLabel("Blade Tip", blade1, 4.2, 0, 0);

        // Direction Arrow (Static in world space, roughly)
        const dirDiv = document.createElement('div');
        dirDiv.className = 'label arrow-label';
        dirDiv.innerHTML = "Rotation &#10227;"; // Unicode arrow
        const dirLabel = new CSS2DObject(dirDiv);
        dirLabel.position.set(0, 2.5, 0);
        scene.add(dirLabel);

        // --- 4. ANIMATION LOOP ---
        
        const rpmSlider = document.getElementById('rpmSlider');
        let speed = 0.02;

        function animate() {
            requestAnimationFrame(animate);

            // Update Speed from Slider
            speed = parseFloat(rpmSlider.value);

            // Rotation Logic
            propellerGroup.rotation.z -= speed; // Counter-clockwise rotation (standard aviation)

            controls.update();
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }

        // Handle Window Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Start
        animate();

    </script>
</body>
</html>
